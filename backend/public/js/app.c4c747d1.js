(function(e){function t(t){for(var o,i,u=t[0],a=t[1],s=t[2],l=0,b=[];l<u.length;l++)i=u[l],Object.prototype.hasOwnProperty.call(c,i)&&c[i]&&b.push(c[i][0]),c[i]=0;for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o]);d&&d(t);while(b.length)b.shift()();return r.push.apply(r,s||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],o=!0,u=1;u<n.length;u++){var a=n[u];0!==c[a]&&(o=!1)}o&&(r.splice(t--,1),e=i(i.s=n[0]))}return e}var o={},c={app:0},r=[];function i(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=o,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var u=window["webpackJsonp"]=window["webpackJsonp"]||[],a=u.push.bind(u);u.push=t,u=u.slice();for(var s=0;s<u.length;s++)t(u[s]);var d=a;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("7a23"),c=n("6c02"),r=n("cf05"),i=n.n(r),u={key:0,alt:"Vue logo",src:i.a},a=Object(o["h"])("Login");function s(e,t,n,c,r,i){var s=Object(o["x"])("Login"),d=Object(o["x"])("router-link"),l=Object(o["x"])("router-view");return Object(o["q"])(),Object(o["f"])(o["a"],null,[r.loggedOut?(Object(o["q"])(),Object(o["f"])("img",u)):Object(o["e"])("",!0),r.loggedOut?(Object(o["q"])(),Object(o["d"])(s,{key:1,onSomeEvent:i.setId},null,8,["onSomeEvent"])):Object(o["e"])("",!0),r.loggedOut?(Object(o["q"])(),Object(o["d"])(d,{key:2,to:"/rtc/".concat(this.usrId),onClick:i.verified},{default:Object(o["D"])((function(){return[a]})),_:1},8,["to","onClick"])):Object(o["e"])("",!0),r.loggedOut?Object(o["e"])("",!0):(Object(o["q"])(),Object(o["d"])(l,{key:3}))],64)}var d=Object(o["g"])("label",{for:"userId"},"UserId: ",-1),l=Object(o["g"])("br",null,null,-1),b=Object(o["g"])("br",null,null,-1),f=Object(o["g"])("label",{for:"password"},"Password: ",-1),p=Object(o["g"])("input",{type:"text",id:"password"},null,-1),O=Object(o["g"])("br",null,null,-1),v=Object(o["g"])("br",null,null,-1);function j(e,t,n,c,r,i){var u=this;return Object(o["q"])(),Object(o["f"])("div",null,[d,Object(o["E"])(Object(o["g"])("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=function(e){return r.inputId=e}),onChange:t[1]||(t[1]=function(t){return e.$emit("someEvent",u.inputId)})},null,544),[[o["B"],r.inputId]]),l,b,f,p,O,v])}var g={name:"Login",data:function(){return{inputId:""}}},h=n("6b0d"),m=n.n(h);const k=m()(g,[["render",j]]);var w=k,y={name:"App",components:{Login:w},data:function(){return{loggedOut:!0,usrId:""}},methods:{verified:function(){this.loggedOut=!1},setId:function(e){this.usrId=e}}};n("66e5");const C=m()(y,[["render",s]]);var S=C,I=function(e){return Object(o["t"])("data-v-20b7678a"),e=e(),Object(o["r"])(),e},P={class:"hello"},D={class:"select"},q=I((function(){return Object(o["g"])("label",{for:"audioSource"},"Audio source: ",-1)})),x={key:0,id:"audioSource"},T={class:"select"},_=I((function(){return Object(o["g"])("label",{for:"videoSource"},"Video source: ",-1)})),E={key:0,id:"videoSource"},R=I((function(){return Object(o["g"])("video",{playsinline:"",autoplay:"",muted:""},null,-1)}));function M(e,t,n,c,r,i){return Object(o["q"])(),Object(o["f"])("div",P,[Object(o["g"])("h2",null,"Client Id: "+Object(o["z"])(i.getUserId),1),Object(o["g"])("section",D,[q,r.updateDevice?(Object(o["q"])(),Object(o["f"])("select",x,[(Object(o["q"])(!0),Object(o["f"])(o["a"],null,Object(o["w"])(r.audios,(function(e){return Object(o["q"])(),Object(o["f"])("option",{key:e.deviceId},Object(o["z"])(e.label||"Microphone ".concat(e.deviceid)),1)})),128))])):Object(o["e"])("",!0)]),Object(o["g"])("section",T,[_,r.updateDevice?(Object(o["q"])(),Object(o["f"])("select",E,[(Object(o["q"])(!0),Object(o["f"])(o["a"],null,Object(o["w"])(r.videos,(function(e){return Object(o["q"])(),Object(o["f"])("option",{key:e.deviceId},Object(o["z"])(e.label||"Camera ".concat(e.deviceId)),1)})),128))])):Object(o["e"])("",!0)]),Object(o["g"])("section",null,[Object(o["g"])("button",{onClick:t[0]||(t[0]=function(){return i.getStream&&i.getStream.apply(i,arguments)}),id:"getStream"},"getStream"),Object(o["g"])("button",{onClick:t[1]||(t[1]=function(){return i.connect&&i.connect.apply(i,arguments)}),id:"connect"},"connect")]),R])}n("d3b7"),n("159b");var L=n("daa8"),U={name:"ClientRtc",props:{},computed:{getUserId:function(){return this.$route.params.userId}},data:function(){return{socketId:"",peerConnections:{},peerConn:null,config:{iceServer:[{urls:"stun:stun.1.google.com:19302"}]},socketPub:null,socketSub:null,stream:null,deviceInfos:null,audios:[],videos:[],updateDevice:!1}},methods:{connect:function(){null===this.socketPub&&(this.socketPub=L["a"].connect("http://localhost:3000")),console.log(this.socketPub)},eventSub:function(){var e=this,t={iceServers:[{urls:"stun:stun.l.google.com:19302"}]};this.socketSub.on("offer",(function(n,o){var c=document.querySelector("video");e.peerConn=new RTCPeerConnection(t),e.peerConn.setRemoteDescription(o).then((function(t){return e.peerConn.setLocalDescription(t)})).then((function(){e.socketSub.emit("answer",n,e.peerConn.localDescription)})),e.peerConn.ontrack=function(e){c.srcObject=e.streams[0]},e.peerConn.onicecandidate=function(t){t.candidate&&e.socketSub.emit("candidate",n,t.candidate)}})),this.socketSub.on("candidate",(function(t,n){e.peerConn.addIceCandidate(new RTCIceCandidate(n)).catch((function(e){return console.error(e)}))})),this.socketSub.on("broadcaster",(function(){e.socketSub.emit("watcher")})),window.onunload=window.onbeforeunload=function(){e.socketSub.close(),e.peerConn.close()}},eventPub:function(){var e=this;this.socketPub.on("answer",(function(t,n){e.peerConnections[t].setRemoteDescription(n)})),this.socketPub.on("watcher",(function(t){var n=new RTCPeerConnection(e.config);e.peerConnections[t]=n;var o=document.querySelector("video"),c=o.srcObject;c.getTracks().forEach((function(e){return n.addTrack(e,c)})),n.onicecandidate=function(n){n.candidate&&e.socketPub.emit("candidate",t,n.candidate)},n.createOffer().then((function(e){return n.setLocalDescription(e)})).then((function(){e.socketPub.emit("offer",t,n.localDescription)}))})),this.socketPub.on("candidate",(function(t,n){e.peerConnections[t].addIceCandidate(new RTCIceCandidate(n))})),this.socketPub.on("disconnectPeer",(function(t){e.peerConnections[t].close(),delete e.peerConnections[t]}))},getStream:function(){var e=this;window.stream&&window.stream.getTracks().forEach((function(e){e.stop()})),"mediaDevices"in navigator&&"getUserMedia"in navigator.mediaDevices&&console.log("Your browser supports mediaDevices API");var t={audio:!0,video:!0};return navigator.mediaDevices.getUserMedia(t).then((function(t){var n=document.querySelector("video");window.stream=t,n.srcObject=t,e.socketPub.emit("broadcaster")})).catch((function(e){console.error("Error: ",e)}))}},mounted:function(){var e=this;navigator.mediaDevices.enumerateDevices().then((function(t){window.deviceInfos=t,t.forEach((function(t){"audioinput"===t.kind?e.audios.push(t):"videoinput"===t.kind&&e.videos.push(t)})),e.updateDevice=!0})),console.log("mounted")}};n("7045");const A=m()(U,[["render",M],["__scopeId","data-v-20b7678a"]]);var z=A,V=[{path:"/rtc/:userId",name:"ClientRtc",component:z},{path:"/",name:"App",component:S}],J=Object(c["a"])({history:Object(c["b"])(),routes:V}),$=Object(o["c"])(S);$.use(J),$.mount("#app")},"60e0":function(e,t,n){},"66e5":function(e,t,n){"use strict";n("e44a")},7045:function(e,t,n){"use strict";n("60e0")},cf05:function(e,t,n){e.exports=n.p+"img/logo.82b9c7a5.png"},e44a:function(e,t,n){}});
//# sourceMappingURL=app.c4c747d1.js.map